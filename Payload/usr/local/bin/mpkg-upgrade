#!/bin/bash
currentuser=$1
pkg=$2
ROOTFS="/"
LIBRARY="/usr/local/mpkglib"

RED='\033[0;31m'
GRN='\033[0;32m'
YEL='\033[0;33m'
BLU='\033[0;34m'
NC='\033[0m'
echo "Loading repository..."
LATEST=$(<$LIBRARY/pref/latest)
RELEASE=$(<$LIBRARY/pref/release)
echo "Checking for update..."
if [[ ! -d $LIBRARY/cache ]]; then
	mkdir $LIBRARY/cache
fi
curl -Ls "$LATEST" -o $LIBRARY/cache/latest
if [[ "$(<$LIBRARY/db/mpkg/version)" == "$(<$LIBRARY/cache/latest)" ]]; then
	echo "Update not found."
else
	echo "Downloading update: $(<$LIBRARY/cache/latest)"
	curl -Ls "$RELEASE/$(<$LIBRARY/cache/latest)/mpkg_$(<$LIBRARY/cache/latest)_darwin64.mpack" -o $LIBRARY/cache/update.mpack
	echo "Installing update!"
	sudo /usr/local/bin/mpkg-install $LIBRARY/cache/update.mpack
fi
echo "Cleaning up..."
sudo rm -r $LIBRARY/cache
echo -e "${GRN}Done.${NC}"
exit